{
    "collab_server" : "",
    "contents" : "# LOAD DATA\nsetwd(\"/Users/mguevara/Dropbox/UPLA/INVESTIGACION/PROYECTOS/BRAZIL-RSPACE/CODES\")\nlibrary(\"scimaps\")\nlibrary(\"diverse\")\n\n#data_institutions <- read.csv(\"../DATA/InstitutionSubDID.csv\")\ndata_researchers <- read.csv(\"../DATA/ResearchersPublicationsSubDisciplines2.csv\")\ndata_researchers[\"InstitutionId\"] <- substr(data_researchers$id_institution, 1,12)\ndata_researchers[\"RegionId\"] <- substr(data_researchers$id_institution, 14,16)\ninstitutions <- read.csv(\"../DATA/list_of_institutions.txt\", sep = \"\\t\")\nregions <- read.csv(\"../DATA/State_Micro_Mun_IDs.csv\")\nregions_full <-regions\nregions <- regions[,c(1,2,3),]\nState_ID <- unique(regions$State_ID)\nState_ShortName <- unique(regions$State_ShortName)\nState_Name <- unique(regions$State_Name)\nregions = data.frame(State_ID,State_ShortName, State_Name)\noutput <- \"../DATA/OUTPUT\" \n  \n#SUBSETING\nn_institutions = 19063\n#year = c(2015,2016,2017)\n#intervals\nyears = matrix(c(1970,1979,1980,1989,1990,1999,2000,2009,2010,2016), nrow = 5, ncol=2, byrow = TRUE)\ndiversity_df = data.frame()\n\nfor(i in c(1:nrow(years)))\n{\n  print(i)\n  print(years[i,1])\n  print(years[i,2])\n  year = c(years[i,1]:years[i,2])\n  #print(year)\n  data_p <- subset(data_researchers, data_researchers$InstitutionId %in% institutions$InstituionID[1:n_institutions])\n  data_p <- data_p[data_p$year %in% year,]\n  #re-organizing\n  print(names(data_p))\n  data_p <- data_p[,c(2,6,10)]  #choosing weighted authorship in column 10\n  #data_p[\"value\"] <- 1\n  \n  #data_p_ins = aggregate(x=data_p[,c(1,3)], by = list(id_institution), FUN = mean)\n  #total production based on weighted final\n  data_p_ins = aggregate(weight_final ~ id_institution, data_p, sum)\n  names(data_p_ins) <- c(\"id_institution\", \"sum_weight_final\")\n\n  print(head(data_p_ins))\n  #computing Diversity using diverse\n  #RAW DIVERSITY\n  div = diverse::diversity(data_p, type=c(\"v\",\"ev\",\"e\"))\n  div[\"id_institution\"] <- rownames(div)\n  div[\"InstituionID\"] <- substr(div$id_institution,1,12)\n  div[\"State_ID\"] <- substr(div$id_institution, 14,16)\n  div[\"year_ini\"] <- year[1]\n  div[\"year_end\"] <- year[length(year)]\n  div[\"years\"] <- paste(year[1],year[length(year)],sep=\"-\")\n  div = merge(div, institutions[,1:2], by= \"InstituionID\")\n  div = merge(div, regions, by=\"State_ID\")\n  div[\"InstitutionName\"] = paste(div$InstitutionName, div$State_ShortName, sep=\"-\")\n  div[\"InstitutionNameShort\"] =  sub('UNIVERSIDADE FEDERAL', 'U.F.',div$InstitutionName)\n  div[\"InstitutionNameShort\"] =  sub('UNIVERSIDADE ESTADUAL', 'U.E.',div$InstitutionNameShort)\n  div[\"InstitutionNameShort\"] =  sub('UNIVERSIDADE', 'U.',div$InstitutionNameShort)\n  div[\"InstitutionNameShort\"] =  sub('INSTITUTO FEDERAL', 'I.F.',div$InstitutionNameShort)\n  div[\"InstitutionNameShort\"] =  sub('INSTITUTO', 'I.',div$InstitutionNameShort)\n  \n  div = merge(div, data_p_ins, by=\"id_institution\") #with total production score\n  print(names(div))\n  \n  #bal =head(balance(data_i))\n  #div = div[, c(7,8,3,4,5,1,2,9)]\n  div = div[order(div$variety, decreasing = TRUE),]\n  print(head(div))\n  m = values(data_p, norm = \"rca\")\n  \n  #accumulate in dataframe\n  diversity_df = rbind.data.frame(diversity_df, div)\n}\n\n\nwrite.csv(diversity_df, file = file.path(output,paste(\"divertsity_decades_1970_2016.csv\")), row.names = FALSE)\n\n\n#computing UBiquity\nub = ubiquity(data_p)\nub[\"ucsd_subdisc_id\"] <- rownames(ub)\nnodes = ucsd_nodes #this data is on scimaps package\nub = merge(ub, nodes[,c(1,7,4)], by=\"ucsd_subdisc_id\")\nub = ub[order(ub$ubiquity, decreasing = TRUE),]\nub = ub[,c(1,4,3,2)]\nwrite.csv(ub, file = file.path(output,paste(\"ubiquity\",year[1], year[length(year)],\".csv\",sep = \"_\")), row.names = FALSE, fileEncoding = \"UTF-8\")\n\n\n######END\n\n\ncant_ins = nrow(data_i[unique(data_i$InstitutionID),])\nprint(\"Number of institutions\")\nprint(cant_ins)\n\n#computing here A map based on Dis-similarities\nadj <- dis_categories(data = data_i, method = \"cosine\" )\nhist(adj)\nadj[adj > 0.6] <- 0  #filter\ng <- graph.adjacency(adjmatrix = adj, mode =  \"undirected\" , weighted = TRUE)\n#plot(g)\n\ntotals <- colSums(values(data_i))\nV(g)$size = log(totals[match(V(g)$name, names(totals))], base = 2) \n#V(g)$size = totals[match(V(g)$name, names(totals))] \nplot(g)\nfc <- fastgreedy.community(g)\ncolors <- rainbow(max(membership(fc)))\n\nV(g)$color = colors[membership(fc)]\nset.seed(67)\ng$layout <- layout.fruchterman.reingold(g)\nplot.igraph(g,  vertex.label.cex = 0.9, vertex.label.font = 0,\n            vertex.label.family =  \"Helvetica\" , vertex.label.color= \"black\" , asp = FALSE)\n\n\n#frecuency\ndata_i <- droplevels(data_i)\n\nfreq_journals = table(data_i$InstitutionID)\nbarplot(freq_journals)\n",
    "created" : 1507215399750.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3016906799",
    "id" : "A54AA449",
    "lastKnownWriteTime" : 1527789544,
    "last_content_update" : 1527789544,
    "path" : "~/Dropbox/UPLA/INVESTIGACION/PROYECTOS/BRAZIL-RSPACE/CODES/brazil-rs.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}