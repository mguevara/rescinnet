{
    "contents" : "setwd(\".\")\nlibrary(reshape2)\nlibrary(xtable)\nsetwd('~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/R J')\n\n\n#path <- \"dataPantheon/dataPantheon.csv\"\n\n\n#pantheon <- readMatrix(\"dataPantheon/PantheonM.csv\", sepr=',')\npath_to_file <- system.file(\"extdata\", \"PantheonMatrix.csv\", package = \"diveR\")\npantheon <- read.csv(path_to_file)\n\npantheon.table <- xtable(pantheon[,1:20], ,caption = \"Number of peopple globally known --according to MIT's Pantheon-- that was born in each country. In this sample, countries represent entities (rows), and occupations represent categories (columns). Showing only 20 of 52 occupations present in the sample data.\", label=\"tab:dataPantheon\",row.names=FALSE)\nprint((pantheon.table))\n\npantheon.latex <- toLatex.xtable(pantheon.table,booktabs=TRUE, widetable=TRUE, rotate.colnames=TRUE, scalebox=0.8, include.rownames=FALSE)\npantheon.latex\n\nwrite(pantheon.latex,file = '~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/R J/tables/dataPantheon.tex')\n\n#reading external edges file\npath_to_file<- system.file(\"extdata\", \"PantheonEdges.csv\", package = \"diveR\")\npantheon_e <- read.csv(path_to_file)\n\n#reading external table file\npantheon.table <- xtable(pantheon_e[1:10,], ,caption = \"Raw data in panel shape. Showing first 10 rows. \", label=\"tab:dataPantheonPanel\",row.names=FALSE)\nprint((pantheon.table))\n\npantheon.latex <- toLatex.xtable(pantheon.table,booktabs=TRUE, widetable=TRUE, rotate.colnames=FALSE, scalebox=0.8, include.rownames=FALSE)\nwrite(pantheon.latex,file = '~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/R J/tables/dataPantheonPanel.tex')\n\n\n#####EXAMPLES\n#need to library or source diversity package for this\nhead(pantheon)\nstr(scidat)\nstr(geese)\n#complete geese matrix, note the entities (years) in columns\ngeese\n\n#cleanning names of scidat\nrm(scidat)\ndata(scidat)\ncolnames(scidat)[nchar(colnames(scidat))>19] <- paste(strtrim(colnames(scidat)[nchar(colnames(scidat))>19], 19), \".\", sep=\"\")\n\n#NORMALIZATION\nlibrary(pheatmap)\ncolfunc <- colorRampPalette(c(\"deepskyblue4\", \"deepskyblue\", \"cyan\"))\nplot_mat <- function(data, main=''){\n\tpheatmap(data, colfunc(100), cluster_rows = FALSE, cluster_cols = FALSE, fontsize = 12)\n}\n\ncol_l <- names(sort(colSums(values(scidat)))) \nrow_l <- names(sort(rowSums(values(scidat)), decreasing=TRUE))\n\nplot_mat(values(scidat)[row_l,col_l])\nplot_mat(values(scidat, norm='p')[row_l,col_l])\nplot_mat(values(scidat, norm='rca')[row_l,col_l])\nplot_mat(values(scidat, norm='rca', filter=1)[row_l,col_l])\n\n\nplot_mat(values(scidat, norm='rca', filter=1, binary = TRUE))\nvariety(values(scidat, norm='rca', filter=1))\n\ndata(pantheon)\ndiversity(data = pantheon, type = 'v')\n\ndiversity(data = geese, type = 'e')\n\nscidat_rca_fil <- values(scidat, norm='ai', filter=0)\nubiquity(scidat_rca_fil)\n\ndiversity(data = geese, type = c('e','ev','bp','s'), category_row = TRUE)\n\n#DIVERSITY SECTION\n#Index of concentration Herfindahl-Hirschman\ndiversity(data = pantheon, type = 'hhi')\n\n#Berger-Parker index of diversity\ndiversity(data = geese, type = 'berger-parker', category_row = TRUE)\n\n#ADVANCED STEPS\n#if alpha = 1 and beta = 0 then RS diversity equals to disparity-weighted variety\ndiversity(data = pantheon, type='rs', alpha = 1, beta = 0)\n\n#if alpha = 0 and beta = 1 then RS diversity equals to balance\ndiversity(data = pantheon, type='rs', alpha = 0, beta = 1)\n\ndiversity(data = pantheon, type='rs', method ='cosine')\n\n#BALANCE SECTION\n#plotting proportions for geese dataset\nbal <- balance(geese, category_row = TRUE)\nbarplot(t(bal), legend = TRUE, xlab = \"Years\", ylab = \"Proportions\", col = c(\"darkblue\",\"blue\",\"sky blue\", \"light blue\"))\n\nbp <- diversity(geese, type = 'bp', category_row = TRUE)\nplot(bp$berger.parker.I~rownames(bp), xlab = \"Years\", ylab = \"Berger Parker Index of Diversity\", pch=19, col = \"brown\")\n\n\n#true diversity\ndiversity(pantheon, type = 'td', q=0)\n\n#disparity for Pantheon dataset\ndim_disparity(data = pantheon, method ='cosine')\n\n\n\n#balance for Pantheon dataset\ndim_balance(pantheon)\n\t#Berger Parker \nbp<- diversity(data = geese, category_row = TRUE, type='bp')\n\n\n#advanced metrics\ndiversity(data = pantheon, type = 'rao')\ndiversity(data = pantheon, type = c('rao', 'rs') )\n\n\ndiversity(data = pantheon, type = 'rs', alpha = 0.2, beta = 0.8)\n\ndis_mat <- dis_categories(data = pantheon, method='cosine') ; str(dis_mat)\n\n\n#SIMILARITIES AMONG CATEGORIES\nlibrary(pheatmap)\ndis_mat <- dis_categories(data = scidat, method='cosine', category_row = TRUE)\ndis_mat\ndis_mat <- dis_mat[names(sort(rowSums(dis_mat))),names(sort(colSums(dis_mat)))]\npheatmap(dis_mat, cluster_rows = FALSE, cluster_cols = FALSE, fontsize=14, fontsize_row = 12, fontsize_col = 12 )\n\n\n#disparities\nscidat_rca_fil <- values(scidat, norm = 'rca', filter = 1)\ndiverse::diversity(scidat_rca_fil, type = 'v')\n\nscidat_rca_fil <- values(scidat, norm = 'rca', filter = 1)\ndisparity(scidat_rca_fil)\n\ndis_mat <- dis_categories(data = values(scidata,norm='rca'), method='cosine', category_row=TRUE)\ndis_mat <- dis_mat[names(sort(rowSums(dis_mat))),names(sort(colSums(dis_mat)))]\npheatmap(dis_mat, cluster_rows = FALSE, cluster_cols = FALSE, fontsize=14, fontsize_row = 10, fontsize_col = 10)\n\n#reading external matrix data file\npath_to_file <- system.file(\"extdata\", \"PantheonMatrix.csv\", package = \"diveR\")\nread.data(path = path_to_file)\n\n#reading external files\n#reading external edges data file\npath_to_file <- system.file(\"extdata\", \"PantheonMatrix.csv\", package = \"diverse\")\nread_data(path = path_to_file)\n\n\n\n\n\n\n\n#ADVANCED EXAMPLE#####WORKS!!! FOR INITIAL scidata.csv do not touch anything!\n\n#old map \nlibrary(\"igraph\")\n#adj <- dis_categories(pantheon)\ndata_ej <- values(scidat)\nadj <- dis_categories(data_ej, method='cosine')\npheatmap(adj, cluster_rows=FALSE, cluster_cols=FALSE)\nhist(adj)\nadj[adj > 0.06] <- 0  #cosine 0.06 adj[adj > 0.06]\n\nhist(adj)\n\ng <- graph.adjacency(adjmatrix = adj,mode = 'undirected',weighted = TRUE)\ntotals <- colSums(values(data_ej))\nV(g)$size = log(totals[match(V(g)$name, names(totals))], base=2) -10\nset.seed(78)#possibles 78 #not use 77,66,99\ng$layout <- layout.fruchterman.reingold(g)\nplot.igraph(g,  vertex.label.cex=0.7, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black',main=title, asp=FALSE)\n\n####for disparity FINAL\nlibrary(igraph)\ndata_ej <- values(scidat)\nadj <- dis_categories(scidat, method='cosine')\nadj[adj > 0.015] <- 0  #filter\n\ng <- graph.adjacency(adjmatrix = adj,mode = 'undirected',weighted = TRUE)\ntotals <- colSums(values(data_ej))\nV(g)$size = log(totals[match(V(g)$name, names(totals))], base=2) -9\nfc <- fastgreedy.community(g); colors <- rainbow(max(membership(fc)))\nV(g)$color = colors[membership(fc)]\nset.seed(67)  #67 a donaut\ng$layout <- layout.fruchterman.reingold(g)\nplot.igraph(g,  vertex.label.cex=0.9, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black', asp=FALSE)\n\n##starts overlay\ncountries <- rownames(scidat)\ntotals_rca <- values(scidat, norm='rca', filter=1)\n\nfor(country in countries){\n\tg_o <- g\ntotals <- data_ej[country,]\nrca_active <- totals_rca[country,]\n#total_country <- data_country/sum(data_country)\nsizes <- log(totals[match(V(g_o)$name, names(totals))]) -  (log(min(scidat)))\ncolors <- V(g)$color \ncolors[is.na(rca_active)]<- \"#cccccc\"\nV(g_o)$color <- colors\n\n#sizes[sizes<=0]<-2\nV(g_o)$size = sizes\nV(g_o)$label <- ''\nplot.igraph(g_o,  vertex.label.cex=0.9, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black', asp=FALSE, main=country)\nplot.igraph(g_o,  vertex.label.cex=0.9, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black', asp=FALSE)\n}\n\n####TESTING \nlibrary(\"igraph\")\n#adj <- dis_categories(pantheon)\ndata_ej <- values(scidat)\nadj <- dis_categories(data_ej, method='cosine')\npheatmap(adj, cluster_rows=FALSE, cluster_cols=FALSE)\nhist(adj)\nfil_dis <- 0.015  #0.019\nadj[adj > fil_dis] <- 0  #cosine 0.06 adj[adj > 0.06]\n\nhist(adj)\n\ng <- graph.adjacency(adjmatrix = adj,mode = 'undirected',weighted = TRUE)\ntotals <- colSums(values(data_ej))\nV(g)$size = log(totals[match(V(g)$name, names(totals))], base=2) -9\nfc <- fastgreedy.community(g)\ncolors <- rainbow(max(membership(fc)))\nV(g)$color = colors[membership(fc)]\n\nfor(i in c(42,67,93))\n{\n\tset.seed(i)#possibles 78 #not use 77,66,99\n\tg$layout <- layout.fruchterman.reingold(g)\n\tplot.igraph(g,  vertex.label.cex=0.9, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black', main=paste('seed',i,'filter',fil_dis), asp=FALSE)\n\t\n}\n\n######\ndiv <- diversity(pantheon)\nadj <- u_dis_categories(pantheon, category_row = TRUE)\nadj[adj< 20] <- 0\ng <- graph.adjacency(adjmatrix = adj,mode = 'undirected',weighted = TRUE)\nV(g)$size = div$entropy[match(V(g)$name, rownames(div))] *10\n#V(g)$color = as.character(div$entropy[match(V(g)$name, rownames(div))])\ng$layout <- layout.fruchterman.reingold(g)\n#V(g)$size = (degree(g)/max(degree(g))) * 9\nplot.igraph(g,  vertex.label.cex=0.7, vertex.label.font=0, vertex.label.family='Helvetica', vertex.label.color='black',main=title, asp=FALSE)\n\n\n\n# Mosaic Plot Example\nlibrary(vcd)\nmosaic(HairEyeColor, shade=TRUE, legend=TRUE)\n\n\n\n#to export to data ######\npantheon <- read.data(path = path_to_file)\nsave(pantheon, file = 'data/pantheon.RData')\n\n\n#creating SCIMAGO DATA\nscidat <- read.csv(\"~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/dataInterdisciPlinarity/scidata9.csv\")\nscidat <- values(scidat)\nsave(scidat, file='data/scidat.RData')\n\n#creating SCIMAGO DATA for 2012\nscidat_2003 <- read.csv(\"~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/dataInterdisciPlinarity/scidat_2003.csv\")\nscidat_2012 <- read.csv(\"~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/dataInterdisciPlinarity/scidat_2012.csv\")\n\nscidat_2 <- values(scidat_2012)\nscidat_2 <- values(scidat_2003)\n#using same rows and columns\nscidat_2 <- scidat_2[rownames(scidat), colnames(scidat)]\n#computing entropy for both datasets\nd_1 <- diversity(scidat, type=\"e\")\nd_2 <- diversity(scidat_2, type=\"e\")\ncor.test(d_1[,1], d_2[,1])\nprint(c_test)\nplot(d_1[,1], d_2[,1])\n\n\nspec_names <- c('Little Grebe', 'Crested Grebe', 'Mute Swan', 'Greylag Goose')\nspecies <- data.frame(row.names=spec_names)\nspecies['1996'] <- c(274,10788,4786,39273)\nspecies['1997'] <- c(247,12319,5551,47714)\nspecies['1998'] <- c(336,11299,6646,53448)\nspecies['1999'] <- c(704,11680,8125,67675)\nspecies['2000'] <- c(815,10996,9025,76547)\nspecies['2001'] <- c(825,10524,10150,87425)\nspecies['2002'] <- c(948,11626,10853,101680)\nspecies['2003'] <- c(844,10617,11056,100901)\nspecies['2004'] <- c(815,9080,11393,110316)\nspecies['2005'] <- c(1134,10050,10771,114651)\nspecies['2006'] <- c(1036,9494,11457,119559)\n\ngeese <- as.matrix(species)\nsave(geese, file ='data/species.RData')\n\n#to export raw data with the package\nwrite.csv(geese, 'inst/extdata/Geese.csv')\n\n\n\n#biodiversity(species, agg_type='col')\n\n#NEW SCIMAGO!!!!!\nsci <- diversity(values(scidata, norm='ai', filter=0), type=c('v', 'e', 'd','rs'))\nsci[order(sci$rao.stirling),]\n#dataFrame\npath_to_file <- system.file(\"extdata\", \"PantheonEdges.sps\", package = \"diveR\")\npantheon <-  read.data(path = path_to_file, type = 'spss')\n\npath_to_file<- system.file(\"extdata\", \"PantheonEdges.dta\", package = \"diveR\")\npantheon <- read.data(path = path_to_file, type='stata')\n\ndata(pantheon)\npantheon\n#characteristics of the example data\nstr(pantheon)\n\npantheon <- read.data(path = path_to_file)\nvariety(pantheon)\n\nubiquity(pantheon)\n\nbalance(pantheon)\n\ndis_categories(pantheon)\n\ndisparity(pantheon)\n\ndiversity(data = pantheon, type = 'all')\n\n#if alpha = 0 and beta = 0 then RS diversity equals to disparity\ndiversity(data=pantheon, type='rs', alpha = 1, beta=0)\n\n#if alpha = 0 and beta = 1 then RS diversity equals to balance\ndiversity(data=pantheon, type='rs', alpha = 0, beta=1)\n\nbarplot(as.table(diversity(pantheon, type='v')))\n\n\n#testing############################\n##### a dataframe with an entity with variety==0, possible division by 0 for disparity\n##### Data that includes ubiquities == 1, which means no posible distances\n##### a small dataframe\n# test_data<- pantheon[sample(nrow(pantheon),20),]\n# test_data <- droplevels(test_data) #cleaning unused levels\n\n##### solved cases in biology, testing simpson, berger parker and entropy and agg_type = col\n#http://ww2.tnstate.edu/ganter/B412%20Extra%20Diversity.html\nspecies <- c('A','B','C','D','E','F')\ns1 <- c(24,20,7,3,0,0)\ns2 <- c(48,40,14,6,0,0)\ns3 <- c(24,20,7,3,3,1)\ntest <- matrix(c(s1,s2,s3), ncol=3, nrow=6)\nrownames(test) <- species\ncolnames(test) <- c('S1','S2','S3')\ndiversity(test, type = 's', agg_type = 'col')\ndiversity(test, type='bp', agg_type = 'col')\nbiodiversity(test, agg_type='col')\n\n\ndiversity(data = pantheon, type = c('v', 'td'), q = 0)\n#solved super dataset of interdisciplinarity SCIENTOMETRICS\n#https://www.dropbox.com/sh/3f84c2ydkamgkub/AAB-IXND5r37M3TNAd0MWm8-a?dl=0\n#http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0127298#pone.0127298.ref009\n\n#other example with simpson\n#http://www.countrysideinfo.co.uk/simpsons.htm\nspecies <- c('Woodrush','Holly(seedlings)','Bramble', 'Yorkshire Fog', 'Sedge')\ntest <- matrix(c(2,8,1,1,3), ncol=1, nrow=5)\nrownames(test) <- species\ncolnames(test) <- c('sample1')dis_categories(data = pantheon, method = 'cosine', category_row = TRUE)\ndiversity(test, type='s', agg_type='col')\n                                                                                                                                                                                   \n#other nice example about Ecological Biodiversity\n#http://www.compass-project.eu/applets/3/index_ES.html\n##### reading files from differente formats\nrownames(geese)\ncolnames(geese)\nbiodiversity(geese,category_row = TRUE)\n\n####testing rao and rao-stirling\nCATEG <- c('C1','C2')\nENT <- c('E1','E2')\ndatam <- matrix(c(1,0,1,1), ncol=2 ,nrow=2)\nrownames(datam) <- ENT\ncolnames(datam) <- CATEG\ndatam\nlibrary(diverse)\nbalance(datam)\ndis_categories(datam)\ndiversity(datam)\n\n\n\n#####error\ndiversity(geese, category_row=TRUE, method='cosine')\n\n",
    "created" : 1447695208811.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2413493150",
    "id" : "5970A855",
    "lastKnownWriteTime" : 1479757790,
    "path" : "~/Dropbox/doctorado/MIT_PROJECT/TESIS_RESEARCH_SPACE/PAPER/PackageDIVERSITY/ scripts.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 0,
    "source_on_save" : false,
    "type" : "r_source"
}